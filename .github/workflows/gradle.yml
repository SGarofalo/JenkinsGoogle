name: Java + Cypress CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    # Checkout the repository
    - name: Checkout code
      uses: actions/checkout@v4

    # Set up JDK 17 for your Java build
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    # Install dependencies (Cypress, Java, Gradle, etc.)
    - name: Install dependencies
      run: |
        npm install
        ./gradlew build

    # Start the application (if required)
    - name: Start application
      run: |
        npm start &
        sleep 10

    # Run Cypress tests and record results in Cypress Dashboard
    - name: Run Cypress tests
      uses: cypress-io/github-action@v5
      with:
        browser: chrome
        headless: true
        record: true
        key: ${{ secrets.CYPRESS_RECORD_KEY }}

    # Ensure everything is stopped after the tests
    - name: Stop application
      if: always()
      run: kill $(jobs -p)
